(()=>{"use strict";class t{constructor({x:t,y:e}){this.x=t,this.y=e}}class e{constructor({TL:t,TR:e,BL:i,BR:s}){this.TL=t,this.TR=e,this.BL=i,this.BR=s}}class i{constructor({top:t,bottom:e,left:i,right:s,collisions:h}){this.top=t,this.bottom=e,this.left=i,this.right=s,this.collisions=h}}class s{constructor(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=720,this.height=480}init(t){this.setSize(),document.getElementById("game").appendChild(this.canvas),setInterval((()=>{return e=this,i=void 0,h=function*(){yield this.clear(),yield t()},new((s=void 0)||(s=Promise))((function(t,n){function o(t){try{c(h.next(t))}catch(t){n(t)}}function r(t){try{c(h.throw(t))}catch(t){n(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(o,r)}c((h=h.apply(e,i||[])).next())}));var e,i,s,h}),15)}checkCollisions(s){const h=this.map.entities,n=[s.x-128,s.x2+128,s.y-128,s.y2+128];s.coords=new e({TL:new t({x:s.x,y:s.y}),TR:new t({x:s.x2,y:s.y}),BL:new t({x:s.x,y:s.y2}),BR:new t({x:s.x2,y:s.y2})});const o=h.filter((t=>s!=t&&t.x>n[0]&&t.x2<n[1]&&t.y>n[2]&&t.y2<n[3])).map((i=>new e({TL:new t({x:i.x,y:i.y}),TR:new t({x:i.x2,y:i.y}),BL:new t({x:i.x,y:i.y2}),BR:new t({x:i.x2,y:i.y2})})));return new i({top:o.filter((t=>t.BL.x<s.coords.TR.x&&t.BR.x>s.coords.TL.x&&s.coords.TL.y==t.BL.y)).length>0,bottom:o.filter((t=>t.TL.x<s.coords.BR.x&&t.TR.x>s.coords.BL.x&&s.coords.BL.y==t.TL.y)).length>0,left:o.filter((t=>t.BL.y>s.coords.TR.y&&t.TL.y<s.coords.BR.y&&s.coords.BL.x==t.BR.x)).length>0,right:o.filter((t=>t.BL.y>s.coords.TR.y&&t.TL.y<s.coords.BR.y&&s.coords.BR.x==t.TL.x)).length>0,collisions:o})}setSize(){this.canvas.width=this.width,this.canvas.height=this.height}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}class h{constructor({gameArea:t,spriteSrc:e="./assets/null.png"}){this.width=64,this.height=64,this.sprite=new Image,this.spriteSrc=e,this.gameArea=t,this.sprite.src=this.spriteSrc}spawn({x:t,y:e}){this.x=t,this.y=e,this.x2=this.x+this.width,this.y2=this.y+this.height}render(){this.x2=this.x+this.width,this.y2=this.y+this.height,this.gameArea.context.drawImage(this.sprite,this.x,this.y,this.width,this.height)}}class n extends h{constructor(){super(...arguments),this.movement=16,this.isJumping=!1,this.fallAccel=-1,this.fallSpeed=0,this.faceRight=!0,this.coords=new e({TL:new t({x:this.x,y:this.y}),TR:new t({x:this.x2,y:this.y}),BL:new t({x:this.x,y:this.y2}),BR:new t({x:this.x2,y:this.y2})})}gravity(){const t=this.gameArea.checkCollisions(this);if(t.bottom)this.fallSpeed=0;else{this.fallSpeed=this.fallSpeed+1;const e=this.y-Math.max(this.fallAccel*this.fallSpeed^2,-16),i=t.collisions.filter((t=>t.TL.x<=this.coords.BR.x&&t.TR.x>=this.coords.BL.x&&t.TL.y>=e+this.height));this.y=i.length>0?i[0].TL.y-this.height:e}}moveLeft(){const t=this.gameArea.checkCollisions(this);this.faceRight=!1,t.left||(this.x=this.x-this.movement)}moveRight(){const t=this.gameArea.checkCollisions(this);this.faceRight=!0,t.right||(this.x=this.x+this.movement)}jump(){this.gameArea.checkCollisions(this).top||(this.y=this.y-this.height)}render(){return t=this,e=void 0,s=function*(){this.x2=this.x+this.width,this.y2=this.y+this.height,this.gravity(),this.gameArea.context.drawImage(this.sprite,this.x,this.y,this.width,this.height)},new((i=void 0)||(i=Promise))((function(h,n){function o(t){try{c(s.next(t))}catch(t){n(t)}}function r(t){try{c(s.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?h(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,r)}c((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class o extends n{constructor(t){var e=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(s=Object.getOwnPropertySymbols(t);h<s.length;h++)e.indexOf(s[h])<0&&Object.prototype.propertyIsEnumerable.call(t,s[h])&&(i[s[h]]=t[s[h]])}return i}(t,[]);super(Object.assign({spriteSrc:"./assets/char-sprite.png"},e)),this.width=48}init(){window.addEventListener("keydown",(t=>{this.keyHandler({code:t.code})}),!1),window.addEventListener("keyup",(t=>{this.keyHandler({code:t.code})}),!1)}keyHandler({code:t}){switch(t){case"KeyS":case"ArrowDown":break;case"KeyW":case"ArrowUp":this.jump();break;case"KeyA":case"ArrowLeft":this.moveLeft();break;case"KeyD":case"ArrowRight":this.moveRight()}}}class r extends h{constructor(t){var e=function(t,e){var i={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(i[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var h=0;for(s=Object.getOwnPropertySymbols(t);h<s.length;h++)e.indexOf(s[h])<0&&Object.prototype.propertyIsEnumerable.call(t,s[h])&&(i[s[h]]=t[s[h]])}return i}(t,[]);super(Object.assign({spriteSrc:"./assets/wall.png"},e)),this.height=48,this.width=48}}class c{constructor({map:t,gameArea:e}){this.entities=[],this.map=t,this.gameArea=e}place(t){for(let e=0;e<this.map.length;e++)for(let i=0;i<this.map[e].length;i++)switch(this.map[e][i]){case 1:const s=new r({gameArea:this.gameArea});s.spawn({x:i*s.width,y:e*s.height}),this.entities.push(s);break;case 2:t.spawn({x:i*t.width,y:e*t.height}),this.entities.push(t)}}placeEntities({type:t,x:e,y:i}){}}const a=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,2,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];window.onload=function(){const t=new s,e=new o({gameArea:t}),i=new c({map:a,gameArea:t});t.map=i,i.place(e),e.init(),t.init((()=>{return t=this,e=void 0,h=function*(){for(let t=0;t<i.entities.length;t++){const e=i.entities[t];yield e.render()}},new((s=void 0)||(s=Promise))((function(i,n){function o(t){try{c(h.next(t))}catch(t){n(t)}}function r(t){try{c(h.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,r)}c((h=h.apply(t,e||[])).next())}));var t,e,s,h}))}})();